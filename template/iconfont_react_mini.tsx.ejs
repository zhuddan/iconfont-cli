import type { ViewProps } from '@tarojs/components'
import type { CSSProperties } from 'react'
import type { IconfontType } from './iconfont-types'
import { View } from '@tarojs/components'
import clsx from 'clsx'
import { useMemo } from 'react'
import data from './iconfont-data'

export interface IconfontCommonProps extends ViewProps {
  size?: number
  color?: string
}

interface IconfontProps extends IconfontCommonProps {
  name: IconfontType
}

export function Iconfont({
  size,
  color = '<%- data.color %>',
  name,
  style,
  className,
  ...rest
}: IconfontProps) {
  const mask = useMemo(() => {
    return `url("data:image/svg+xml;charset=utf-8,${encodeURIComponent(data[name])}")`
  }, [name])
  const innerStyle = useMemo(() => {
    const _style = typeof style === 'string' ? {} : style
    return {
      ..._style,
      'mask': mask,
      // eslint-disable-next-line ts/ban-ts-comment
      // @ts-expect-error
      '-webkit-mask': mask,
      'backgroundColor': color,
      'width': size ? `${size}<%- data.unit %>` : '1em',
      'height': size ? `${size}<%- data.unit %>` : '1em',
      'display': 'inline-block',
      'backgroundRepeat': 'no-repeat',
    } satisfies CSSProperties
  }, [color, mask, size, style])
  return (
    <View
      className={clsx('iconfont', className)}
      style={innerStyle}
      {...rest}
    >
    </View>
  )
}
